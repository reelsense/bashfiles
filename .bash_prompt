#!/bin/bash

## include all the prompt libraries ##
######################################
for prompt_lib in `ls ~/.bash_prompt.d`; do
	. ~/.bash_prompt.d/$prompt_lib
done

## build the actual prompt ##
#############################
# NOTE: the remote host is calculated at shell startup, and depend on the USER/HOSTNAME envvars
PROMPT_CHUNK_SIMPLE="\[\e[${PREFERRED_COLOR:-33}m\]$(__remote_host)\$(project_ps1)"

# add git to the prompt
export GIT_PS1_SHOWDIRTYSTATE=true
export GIT_PS1_SHOWSTASHSTATE=true
# GIT_PS1_SHOWUPSTREAM="false"
export GIT_PS1_SHOWUNTRACKEDFILES=true
PROMPT_CHUNK_GIT="\[\e[91m\]\$(__git_ps1 ' (%s) ')"

# add svn to the prompt
# SVN_PS1_SHOWDIRTYSTATE=
# SVN_PS1_SHOWREVISION=
# PS1="${PS1}\[\e[91m\]\$(__svn_ps1 ' (%s) ')"

export PS1="$PROMPT_CHUNK_SIMPLE$PROMPT_CHUNK_GIT\[\e[${PREFERRED_COLOR:-33}m\]\$ \[\e[m\]"

# helper function to fallback on a simpler prompt for when git is slow #
##############################################################################
function fallback_prompt() {
	export PS1="$PROMPT_CHUNK_SIMPLE\[\e[${PREFERRED_COLOR:-33}m\]\$ \[\e[m\]"
}

# Change the terminal title when switching directories #
########################################################
function project_set_title() {
	set_title "$title"
}
CHDIR_COMMAND="${CHDIR_COMMAND}project_set_title;"

unset color_prompt force_color_prompt
